import{r as o,A as P,u as w,j as a,l as C}from"./index-af1d8954.js";import{u as N,c as A,a as S,b as s,I as F}from"./Input-421ca7c9.js";import{u as q,W as M,r}from"./http-hooks-95b67396.js";import"./tiny-warning.esm-d436548b.js";const L=()=>{const i=o.useContext(P),{isLoading:n,error:c,sendRequest:u,clearError:h}=q(),[p,d]=o.useState(!1),[m,g]=o.useState(""),[x,v]=o.useState(""),y=w(),e=N({initialValues:{photo:"",title:"",description:"",address:"",latitude:"",longitude:""},validationSchema:A({photo:S().required("Please upload an image"),title:s().min(6,"Must be at least 6 character").required("Please enter valid title"),description:s().min(10,"Must be at least 10 character").required("Please enter valid description"),address:s().required("Please enter an address"),latitude:s().required("Please enter an latitude"),longitude:s().required("Please enter an longitude")}),onSubmit:async()=>{try{const t=new FormData;t.append("title",e.values.title),t.append("description",e.values.description),t.append("address",e.values.address),t.append("latitude",e.values.latitude),t.append("longitude",e.values.longitude),t.append("image",m),await u("https://mern-practice-be-wwsf.onrender.com/api/places","POST",t,{Authorization:"Bearer "+i.token}),y.push("/")}catch(t){console.log(t),d(!0)}e.values.photo=""}}),f=t=>{e.handleChange(t),g(t.target.files[0]);const l=new FileReader;l.onload=()=>{v(l.result)},l.readAsDataURL(t.target.files[0]||"")},b=[{name:"photo",label:"Photo",type:"file",touched:e.touched.photo,error:e.errors.photo,value:e.values.photo,onChangePhoto:f},{name:"title",label:"Title",type:"title",touched:e.touched.title,error:e.errors.title,value:e.values.title},{name:"description",label:"Description",type:"description",touched:e.touched.description,error:e.errors.description,value:e.values.description,isTextArea:!0},{name:"address",label:"Address",type:"address",touched:e.touched.address,error:e.errors.address,value:e.values.address},{name:"latitude",label:"Latitude",type:"text",touched:e.touched.latitude,error:e.errors.latitude,value:e.values.latitude},{name:"longitude",label:"Longitude",type:"text",touched:e.touched.longitude,error:e.errors.longitude,value:e.values.longitude}],j=()=>{d(t=>!t)};return a.jsxs("div",{className:"flex justify-center",children:[a.jsx(M,{toogleModal:j,openModal:p,message:c,onClear:h}),a.jsx(r.Card,{className:"w-[90%] md:w-[50%]",children:a.jsxs("form",{onSubmit:e.handleSubmit,children:[a.jsx(r.Typography,{variant:"h5",color:"blue-gray",className:"px-4 pt-5",children:"Add Place"}),n?a.jsx(r.CardBody,{className:"flex justify-center",children:a.jsx("img",{className:"w-[150px]",src:C,alt:"loading"})}):a.jsxs(a.Fragment,{children:[a.jsxs(r.CardBody,{className:"flex flex-col gap-5 py-5",children:[e.values.photo&&a.jsx("div",{className:"flex justify-center",children:a.jsx("img",{className:"w-full h-[275px] object-cover rounded-lg mb-5",src:x,alt:""})}),b.map(t=>a.jsx(F,{formik:e,id:t.name,name:t.name,label:t.label,touched:t.touched,error:t.error,type:t.type,value:t.value,isTextArea:t.isTextArea,onChangePhoto:t.onChangePhoto},t.name))]}),a.jsx(r.CardFooter,{className:"text-right",children:a.jsx(r.Button,{disabled:!(e.isValid&&e.dirty),color:e.isValid&&e.dirty?"blue":"red",className:e.isValid&&e.dirty?"cursor-pointer":"cursor-not-allowed",type:"submit",children:"Submit"})})]})]})})]})};export{L as default};
